<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Trading Scanner Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .card { @apply bg-white rounded-xl shadow-lg border border-gray-100; }
        .metric-card { @apply p-6 rounded-lg border-2 text-center; }
        .status-dot { @apply w-4 h-4 rounded-full; }
        .badge { @apply px-3 py-1 rounded-full text-sm font-medium; }
        .table-header { @apply px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider; }
        .table-cell { @apply px-6 py-4 text-sm; }
        
        .loading-spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .coin-image {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
    <div class="max-w-7xl mx-auto p-8 space-y-8">
        
        <!-- HEADER SECTION -->
        <div class="card p-8">
            <div class="flex justify-between items-start mb-8">
                <div>
                    <div class="flex items-center space-x-4 mb-3">
                        <h1 class="text-4xl font-bold text-gray-900">Live Trading Scanner</h1>
                        <div class="status-dot bg-green-400 pulse-animation" id="mainStatusDot"></div>
                        <span class="badge bg-green-100 text-green-700" id="systemStatus">üü¢ LIVE</span>
                    </div>
                    <p class="text-gray-600 text-lg">Real-time market analysis with AI-powered scoring from CoinGecko & Yahoo Finance</p>
                </div>
                <div class="flex space-x-4">
                    <button id="autoRefreshBtn" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-medium flex items-center space-x-2">
                        <span>‚ö°</span>
                        <span>AUTO ON</span>
                    </button>
                    <button id="manualRefreshBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium flex items-center space-x-2" onclick="refreshData()">
                        <span>üîÑ</span>
                        <span>REFRESH</span>
                    </button>
                </div>
            </div>

            <!-- METRICS DASHBOARD -->
            <div class="grid grid-cols-2 md:grid-cols-6 gap-6">
                <div class="metric-card border-green-200 bg-green-50">
                    <div class="text-2xl mb-2">ü™ô</div>
                    <div class="font-semibold text-gray-800">CoinGecko API</div>
                    <div class="text-green-600 font-medium mt-2" id="coinGeckoStatus">‚úì Connected</div>
                </div>
                
                <div class="metric-card border-blue-200 bg-blue-50">
                    <div class="text-2xl mb-2">üí≤</div>
                    <div class="font-semibold text-gray-800">Yahoo Finance</div>
                    <div class="text-blue-600 font-medium mt-2" id="yahooStatus">‚úì Connected</div>
                </div>
                
                <div class="metric-card border-purple-200 bg-purple-50">
                    <div class="text-3xl font-bold text-purple-600 mb-1" id="cryptoCount">0</div>
                    <div class="font-semibold text-gray-800">Crypto Signals</div>
                    <div class="text-purple-600 text-xs mt-1">Live from CoinGecko</div>
                </div>
                
                <div class="metric-card border-indigo-200 bg-indigo-50">
                    <div class="text-3xl font-bold text-indigo-600 mb-1" id="stockCount">0</div>
                    <div class="font-semibold text-gray-800">Stock Signals</div>
                    <div class="text-indigo-600 text-xs mt-1">Live from Yahoo</div>
                </div>
                
                <div class="metric-card border-orange-200 bg-orange-50">
                    <div class="text-xl font-mono text-orange-600 mb-1" id="lastUpdateTime">--:--:--</div>
                    <div class="font-semibold text-gray-800">Last Update</div>
                    <div class="text-orange-600 text-xs mt-1">Auto refresh</div>
                </div>
                
                <div class="metric-card border-gray-200 bg-gray-50">
                    <div class="text-2xl font-mono text-gray-600 mb-1" id="totalSignals">#0</div>
                    <div class="font-semibold text-gray-800">Total Signals</div>
                    <div class="text-gray-600 text-xs mt-1">Combined data</div>
                </div>
            </div>
        </div>

        <!-- NAVIGATION TABS -->
        <div class="card p-2">
            <div class="flex space-x-2">
                <button id="cryptoTab" class="flex-1 bg-blue-500 text-white py-4 px-6 rounded-lg font-semibold text-lg tab-button" onclick="showCrypto()">
                    ü™ô Crypto Signals (<span id="cryptoTabCount">0</span>)
                </button>
                <button id="stockTab" class="flex-1 bg-gray-100 text-gray-600 py-4 px-6 rounded-lg font-semibold text-lg hover:bg-gray-200 tab-button" onclick="showStocks()">
                    üìà Stock Signals (<span id="stockTabCount">0</span>)
                </button>
            </div>
        </div>

        <!-- FILTER CRITERIA -->
        <div class="card p-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                <span class="mr-3">üéØ</span>
                Active Filters & Criteria
            </h2>
            
            <div class="grid md:grid-cols-3 gap-8">
                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-blue-600 flex items-center">
                        <span class="mr-2">üìä</span>
                        Basic Filters
                    </h3>
                    <div class="space-y-3 text-gray-700">
                        <div class="flex justify-between py-2 border-b border-gray-100">
                            <span>Volume (24h)</span>
                            <span class="font-medium">$10M+ Crypto / 100K+ Stocks</span>
                        </div>
                        <div class="flex justify-between py-2 border-b border-gray-100">
                            <span>Price Change</span>
                            <span class="font-medium">1-50% Crypto / 0.5%+ Stocks</span>
                        </div>
                        <div class="flex justify-between py-2 border-b border-gray-100">
                            <span>Market Cap</span>
                            <span class="font-medium">$50M+ Crypto</span>
                        </div>
                        <div class="flex justify-between py-2">
                            <span>Data Source</span>
                            <span class="font-medium">Live APIs</span>
                        </div>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-green-600 flex items-center">
                        <span class="mr-2">‚öôÔ∏è</span>
                        Technical Filters
                    </h3>
                    <div class="space-y-3 text-gray-700">
                        <div class="flex justify-between py-2 border-b border-gray-100">
                            <span>RSI Range</span>
                            <span class="font-medium">Dynamic calculation</span>
                        </div>
                        <div class="flex justify-between py-2 border-b border-gray-100">
                            <span>ATR Volatility</span>
                            <span class="font-medium">2-8% optimal</span>
                        </div>
                        <div class="flex justify-between py-2 border-b border-gray-100">
                            <span>Relative Volume</span>
                            <span class="font-medium">1.5x+ preferred</span>
                        </div>
                        <div class="flex justify-between py-2">
                            <span>Momentum</span>
                            <span class="font-medium">Multi-timeframe</span>
                        </div>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-purple-600 flex items-center">
                        <span class="mr-2">üß†</span>
                        AI Scoring System
                    </h3>
                    <div class="space-y-3 text-gray-700">
                        <div class="flex justify-between py-2 border-b border-gray-100">
                            <span>Base Score</span>
                            <span class="font-medium">6.0</span>
                        </div>
                        <div class="flex justify-between py-2 border-b border-gray-100">
                            <span>Volume Bonus</span>
                            <span class="font-medium">+0.5 to +1.5</span>
                        </div>
                        <div class="flex justify-between py-2 border-b border-gray-100">
                            <span>Technical Bonus</span>
                            <span class="font-medium">+0.8 to +1.2</span>
                        </div>
                        <div class="flex justify-between py-2">
                            <span>Max Score</span>
                            <span class="font-medium">10.0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CRYPTO RESULTS TABLE -->
        <div class="card" id="cryptoSection">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-900 flex items-center">
                        <span class="mr-3">ü™ô</span>
                        Live Crypto Signals
                    </h2>
                    <span class="text-gray-500" id="cryptoLastUpdate">Loading...</span>
                </div>
            </div>

            <div class="overflow-x-auto" id="cryptoTableContainer">
                <div class="p-8 text-center">
                    <div class="loading-spinner"></div>
                    <p class="mt-4 text-gray-600">Loading crypto signals...</p>
                </div>
            </div>
        </div>

        <!-- STOCK RESULTS TABLE -->
        <div class="card hidden" id="stockSection">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-900 flex items-center">
                        <span class="mr-3">üìà</span>
                        Live Stock Signals
                    </h2>
                    <span class="text-gray-500" id="stockLastUpdate">Loading...</span>
                </div>
            </div>

            <div class="overflow-x-auto" id="stockTableContainer">
                <div class="p-8 text-center">
                    <div class="loading-spinner"></div>
                    <p class="mt-4 text-gray-600">Loading stock signals...</p>
                </div>
            </div>
        </div>

        <!-- DETAILED ANALYSIS CARD (Hidden by default) -->
        <div class="card p-8 hidden" id="detailsSection">
            <h3 class="text-2xl font-bold text-blue-600 mb-6 flex items-center">
                <span class="mr-3">üîç</span>
                Detailed Analysis - <span id="detailsSymbol">Select a signal</span>
            </h3>
            
            <div class="grid md:grid-cols-3 gap-8" id="detailsContent">
                <!-- Content will be populated dynamically -->
            </div>
        </div>

        <!-- FOOTER -->
        <div class="text-center text-gray-500 py-8">
            <div class="text-lg font-medium mb-2">
                Live Trading Scanner v2.0 ‚Ä¢ LIVE MODE
            </div>
            <div class="text-sm">
                ü™ô CoinGecko API ‚Ä¢ üìà Yahoo Finance ‚Ä¢ ü§ñ AI Powered ‚Ä¢ ‚ö° Auto-Refresh ‚Ä¢ üö´ Not Financial Advice
            </div>
        </div>
    </div>

    <script>
        // Global state
        let cryptoData = [];
        let stockData = [];
        let autoRefreshEnabled = true;
        let refreshInterval = null;
        let currentTab = 'crypto';

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
            startAutoRefresh();
        });

        // Auto-refresh functionality
        function startAutoRefresh() {
            if (refreshInterval) clearInterval(refreshInterval);
            refreshInterval = setInterval(loadAllData, 5 * 60 * 1000); // 5 minutes
        }

        function toggleAutoRefresh() {
            const btn = document.getElementById('autoRefreshBtn');
            autoRefreshEnabled = !autoRefreshEnabled;
            
            if (autoRefreshEnabled) {
                btn.innerHTML = '<span>‚ö°</span><span>AUTO ON</span>';
                btn.className = 'bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-medium flex items-center space-x-2';
                startAutoRefresh();
            } else {
                btn.innerHTML = '<span>‚è∏Ô∏è</span><span>AUTO OFF</span>';
                btn.className = 'bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium flex items-center space-x-2';
                if (refreshInterval) clearInterval(refreshInterval);
            }
        }

        // Add click event to auto-refresh button
        document.getElementById('autoRefreshBtn').addEventListener('click', toggleAutoRefresh);

        // Load all data
        async function loadAllData() {
            console.log('Loading all trading data...');
            
            // Update refresh button
            const refreshBtn = document.getElementById('manualRefreshBtn');
            const originalContent = refreshBtn.innerHTML;
            refreshBtn.innerHTML = '<div class="loading-spinner" style="width: 20px; height: 20px;"></div><span>Loading...</span>';
            refreshBtn.disabled = true;

            try {
                // Load data from JSON files (generated by GitHub Actions)
                const [cryptoResponse, stockResponse] = await Promise.all([
                    fetch('./data/crypto.json?t=' + Date.now()).catch(e => ({ ok: false, error: e })),
                    fetch('./data/stocks.json?t=' + Date.now()).catch(e => ({ ok: false, error: e }))
                ]);

                // Process crypto data
                if (cryptoResponse.ok) {
                    const cryptoResult = await cryptoResponse.json();
                    cryptoData = cryptoResult.data || [];
                    document.getElementById('coinGeckoStatus').innerHTML = '‚úì Connected';
                    document.getElementById('coinGeckoStatus').className = 'text-green-600 font-medium mt-2';
                } else {
                    document.getElementById('coinGeckoStatus').innerHTML = '‚ùå Error';
                    document.getElementById('coinGeckoStatus').className = 'text-red-600 font-medium mt-2';
                }

                // Process stock data
                if (stockResponse.ok) {
                    const stockResult = await stockResponse.json();
                    stockData = stockResult.data || [];
                    document.getElementById('yahooStatus').innerHTML = '‚úì Connected';
                    document.getElementById('yahooStatus').className = 'text-blue-600 font-medium mt-2';
                } else {
                    document.getElementById('yahooStatus').innerHTML = '‚ùå Error';
                    document.getElementById('yahooStatus').className = 'text-red-600 font-medium mt-2';
                }

                // Update counters
                updateCounters();
                
                // Render current tab
                if (currentTab === 'crypto') {
                    renderCryptoTable();
                } else {
                    renderStockTable();
                }

                // Update last update time
                document.getElementById('lastUpdateTime').textContent = new Date().toLocaleTimeString();

            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('systemStatus').innerHTML = 'üî¥ ERROR';
                document.getElementById('systemStatus').className = 'badge bg-red-100 text-red-700';
            } finally {
                // Reset refresh button
                refreshBtn.innerHTML = originalContent;
                refreshBtn.disabled = false;
            }
        }

        // Manual refresh function
        function refreshData() {
            loadAllData();
        }

        // Update all counters
        function updateCounters() {
            const cryptoCount = cryptoData.length;
            const stockCount = stockData.length;
            const totalCount = cryptoCount + stockCount;

            document.getElementById('cryptoCount').textContent = cryptoCount;
            document.getElementById('stockCount').textContent = stockCount;
            document.getElementById('cryptoTabCount').textContent = cryptoCount;
            document.getElementById('stockTabCount').textContent = stockCount;
            document.getElementById('totalSignals').textContent = '#' + totalCount;
        }

        // Tab switching functions
        function showCrypto() {
            currentTab = 'crypto';
            document.getElementById('cryptoTab').className = 'flex-1 bg-blue-500 text-white py-4 px-6 rounded-lg font-semibold text-lg tab-button';
            document.getElementById('stockTab').className = 'flex-1 bg-gray-100 text-gray-600 py-4 px-6 rounded-lg font-semibold text-lg hover:bg-gray-200 tab-button';
            document.getElementById('cryptoSection').classList.remove('hidden');
            document.getElementById('stockSection').classList.add('hidden');
            renderCryptoTable();
        }

        function showStocks() {
            currentTab = 'stocks';
            document.getElementById('cryptoTab').className = 'flex-1 bg-gray-100 text-gray-600 py-4 px-6 rounded-lg font-semibold text-lg hover:bg-gray-200 tab-button';
            document.getElementById('stockTab').className = 'flex-1 bg-blue-500 text-white py-4 px-6 rounded-lg font-semibold text-lg tab-button';
            document.getElementById('cryptoSection').classList.add('hidden');
            document.getElementById('stockSection').classList.remove('hidden');
            renderStockTable();
        }

        // Render crypto table
        function renderCryptoTable() {
            const container = document.getElementById('cryptoTableContainer');
            
            if (!cryptoData || cryptoData.length === 0) {
                container.innerHTML = `
                    <div class="p-8 text-center">
                        <div class="text-6xl mb-4">ü™ô</div>
                        <h3 class="text-xl font-semibold text-gray-700 mb-2">No crypto signals available</h3>
                        <p class="text-gray-500">Waiting for market data updates...</p>
                    </div>
                `;
                return;
            }

            let tableHTML = `
                <table class="w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="table-header">RANK</th>
                            <th class="table-header">COIN</th>
                            <th class="table-header">PRICE</th>
                            <th class="table-header">CHANGE 24H</th>
                            <th class="table-header">VOLUME</th>
                            <th class="table-header">RVOL</th>
                            <th class="table-header">RSI</th>
                            <th class="table-header">AI SCORE</th>
                            <th class="table-header">ACTION</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100">
            `;

            cryptoData.forEach((crypto, index) => {
                const rankColor = index === 0 ? 'bg-yellow-400' : index === 1 ? 'bg-gray-300' : 'bg-orange-300';
                const changeClass = crypto.change24h >= 0 ? 'text-green-600' : 'text-red-600';
                const momentumBadge = getMomentumBadge(crypto.momentum);
                const aiScoreBadge = getAIScoreBadge(crypto.aiScore);
                
                tableHTML += `
                    <tr class="bg-gradient-to-r from-green-50 to-transparent hover:bg-green-100">
                        <td class="table-cell">
                            <div class="w-8 h-8 ${rankColor} text-white rounded-full flex items-center justify-center font-bold">${index + 1}</div>
                        </td>
                        <td class="table-cell">
                            <div class="flex items-center space-x-3">
                                ${crypto.image ? `<img src="${crypto.image}" alt="${crypto.coin}" class="coin-image">` : 
                                  `<div class="w-10 h-10 bg-gradient-to-r from-purple-400 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-xs">${crypto.coin.substring(0, 3)}</div>`}
                                <div>
                                    <div class="font-semibold text-gray-900">${crypto.name || crypto.coin}</div>
                                    <div class="text-gray-500">${crypto.symbol || crypto.coin + 'USDT'}</div>
                                </div>
                            </div>
                        </td>
                        <td class="table-cell">
                            <div class="font-mono text-lg font-semibold">$${formatPrice(crypto.price)}</div>
                        </td>
                        <td class="table-cell">
                            <div class="font-semibold ${changeClass}">${crypto.change24h >= 0 ? '+' : ''}${crypto.change24h.toFixed(2)}%</div>
                            ${crypto.change1h ? `<div class="text-gray-500 text-xs">${crypto.change1h >= 0 ? '+' : ''}${crypto.change1h.toFixed(2)}% (1h)</div>` : ''}
                        </td>
                        <td class="table-cell">
                            <div class="font-semibold">$${formatVolume(crypto.volume24h)}</div>
                        </td>
                        <td class="table-cell">
                            <span class="${getRvolBadgeClass(crypto.rvol)}">${crypto.rvol.toFixed(1)}x</span>
                        </td>
                        <td class="table-cell">
                            <span class="font-mono">${crypto.rsi.toFixed(1)}</span>
                        </td>
                        <td class="table-cell">
                            <div class="text-center">
                                <div class="${aiScoreBadge.class}">${crypto.aiScore}</div>
                                <div class="${momentumBadge.class}">${crypto.momentum}</div>
                            </div>
                        </td>
                        <td class="table-cell">
                            <button class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 font-medium" onclick="showDetails('stock', ${index})">
                                View Details
                            </button>
                        </td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table>';
            container.innerHTML = tableHTML;
            
            document.getElementById('stockLastUpdate').textContent = 'Last updated: ' + new Date().toLocaleTimeString();
        }

        // Show detailed analysis
        function showDetails(type, index) {
            const data = type === 'crypto' ? cryptoData[index] : stockData[index];
            const symbol = type === 'crypto' ? data.symbol : data.symbol;
            
            document.getElementById('detailsSymbol').textContent = symbol;
            document.getElementById('detailsSection').classList.remove('hidden');
            
            const isCrypto = type === 'crypto';
            const stopLoss = isCrypto ? data.stopLoss : data.stopLoss;
            const takeProfit = isCrypto ? data.takeProfit : data.takeProfit;
            const riskReward = isCrypto ? data.riskReward : data.riskReward;
            
            document.getElementById('detailsContent').innerHTML = `
                <!-- TRADING SETUP -->
                <div class="bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-xl">
                    <h4 class="text-lg font-semibold text-green-700 mb-4 flex items-center">
                        <span class="mr-2">üéØ</span>
                        Trading Setup
                    </h4>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                            <span class="text-gray-600">Entry Price</span>
                            <span class="font-mono font-bold text-lg">${formatPrice(data.price)}</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                            <span class="text-gray-600">Stop Loss</span>
                            <span class="font-mono font-bold text-lg text-red-600">${formatPrice(stopLoss)}</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                            <span class="text-gray-600">Take Profit</span>
                            <span class="font-mono font-bold text-lg text-green-600">${formatPrice(takeProfit)}</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                            <span class="text-gray-600">Risk/Reward</span>
                            <span class="font-mono font-bold text-lg text-blue-600">${riskReward}</span>
                        </div>
                    </div>
                </div>

                <!-- TECHNICAL ANALYSIS -->
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-xl">
                    <h4 class="text-lg font-semibold text-blue-700 mb-4 flex items-center">
                        <span class="mr-2">üìà</span>
                        Technical Analysis
                    </h4>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                            <span class="text-gray-600">RSI (14)</span>
                            <span class="badge bg-blue-100 text-blue-700">${data.rsi.toFixed(1)}</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                            <span class="text-gray-600">ATR</span>
                            <span class="badge bg-purple-100 text-purple-700">${data.atr.toFixed(1)}%</span>
                        </div>
                        ${isCrypto ? `
                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                            <span class="text-gray-600">Market Cap</span>
                            <span class="font-mono font-semibold">${formatVolume(data.marketCap)}</span>
                        </div>
                        ` : `
                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                            <span class="text-gray-600">Day Range</span>
                            <span class="font-mono font-semibold">${data.dayLow?.toFixed(2)} - ${data.dayHigh?.toFixed(2)}</span>
                        </div>
                        `}
                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                            <span class="text-gray-600">Volume ${isCrypto ? '24h' : ''}</span>
                            <span class="font-mono font-semibold">${formatVolume(isCrypto ? data.volume24h : data.volume)}</span>
                        </div>
                    </div>
                </div>

                <!-- RISK ASSESSMENT -->
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-6 rounded-xl">
                    <h4 class="text-lg font-semibold text-purple-700 mb-4 flex items-center">
                        <span class="mr-2">‚öñÔ∏è</span>
                        Risk Assessment
                    </h4>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                            <span class="text-gray-600">Pump Check</span>
                            <span class="badge ${data.pumpCheck === 'Clean' ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'}">${data.pumpCheck}</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                            <span class="text-gray-600">Momentum</span>
                            <span class="${getMomentumBadge(data.momentum).class}">${data.momentum}</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                            <span class="text-gray-600">Data Source</span>
                            <span class="text-blue-600 font-medium">${data.dataSource}</span>
                        </div>
                        <div class="p-3 bg-white rounded-lg">
                            <a href="https://tradingview.com/chart/?symbol=${isCrypto ? 'BINANCE:' + data.symbol : data.symbol}" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium flex items-center">
                                <span class="mr-2">üîó</span>
                                View Live Chart
                            </a>
                        </div>
                    </div>
                </div>
            `;
            
            // Scroll to details section
            document.getElementById('detailsSection').scrollIntoView({ behavior: 'smooth' });
        }

        // Helper functions
        function formatPrice(price) {
            if (!price) return '0.00';
            if (price < 0.01) return price.toFixed(6);
            if (price < 1) return price.toFixed(4);
            if (price < 100) return price.toFixed(2);
            return price.toFixed(0);
        }

        function formatVolume(volume) {
            if (!volume) return '0';
            if (volume >= 1000000000) return (volume / 1000000000).toFixed(1) + 'B';
            if (volume >= 1000000) return (volume / 1000000).toFixed(1) + 'M';
            if (volume >= 1000) return (volume / 1000).toFixed(1) + 'K';
            return volume.toString();
        }

        function getRvolBadgeClass(rvol) {
            if (rvol >= 4) return 'badge bg-red-100 text-red-700';
            if (rvol >= 2.5) return 'badge bg-yellow-100 text-yellow-700';
            return 'badge bg-green-100 text-green-700';
        }

        function getMomentumBadge(momentum) {
            switch(momentum) {
                case 'Very Strong':
                    return { class: 'badge bg-red-100 text-red-700 mt-1' };
                case 'Strong':
                    return { class: 'badge bg-green-100 text-green-600 mt-1' };
                default:
                    return { class: 'badge bg-yellow-100 text-yellow-600 mt-1' };
            }
        }

        function getAIScoreBadge(score) {
            if (score >= 8.5) return { class: 'badge bg-green-500 text-white text-base font-bold' };
            if (score >= 7.5) return { class: 'badge bg-green-400 text-white text-base font-bold' };
            if (score >= 6.5) return { class: 'badge bg-yellow-400 text-white text-base font-bold' };
            return { class: 'badge bg-gray-400 text-white text-base font-bold' };
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            if (event.key === 'r' && (event.ctrlKey || event.metaKey)) {
                event.preventDefault();
                refreshData();
            }
            if (event.key === '1') {
                showCrypto();
            }
            if (event.key === '2') {
                showStocks();
            }
        });

        // Close details section when clicking outside
        document.addEventListener('click', function(event) {
            if (event.target.closest('#detailsSection') === null && 
                event.target.closest('button[onclick*="showDetails"]') === null) {
                // Don't auto-close for now, let user manually navigate
            }
        });
    </script>
</body>
</html>600 font-medium" onclick="showDetails('crypto', ${index})">
                                View Details
                            </button>
                        </td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table>';
            container.innerHTML = tableHTML;
            
            document.getElementById('cryptoLastUpdate').textContent = 'Last updated: ' + new Date().toLocaleTimeString();
        }

        // Render stock table
        function renderStockTable() {
            const container = document.getElementById('stockTableContainer');
            
            if (!stockData || stockData.length === 0) {
                container.innerHTML = `
                    <div class="p-8 text-center">
                        <div class="text-6xl mb-4">üìà</div>
                        <h3 class="text-xl font-semibold text-gray-700 mb-2">No stock signals available</h3>
                        <p class="text-gray-500">Waiting for market data updates...</p>
                    </div>
                `;
                return;
            }

            let tableHTML = `
                <table class="w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="table-header">RANK</th>
                            <th class="table-header">STOCK</th>
                            <th class="table-header">PRICE</th>
                            <th class="table-header">CHANGE 24H</th>
                            <th class="table-header">VOLUME</th>
                            <th class="table-header">RVOL</th>
                            <th class="table-header">RSI</th>
                            <th class="table-header">AI SCORE</th>
                            <th class="table-header">ACTION</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100">
            `;

            stockData.forEach((stock, index) => {
                const rankColor = index === 0 ? 'bg-yellow-400' : index === 1 ? 'bg-gray-300' : 'bg-orange-300';
                const changeClass = stock.change24h >= 0 ? 'text-green-600' : 'text-red-600';
                const momentumBadge = getMomentumBadge(stock.momentum);
                const aiScoreBadge = getAIScoreBadge(stock.aiScore);
                
                tableHTML += `
                    <tr class="bg-gradient-to-r from-blue-50 to-transparent hover:bg-blue-100">
                        <td class="table-cell">
                            <div class="w-8 h-8 ${rankColor} text-white rounded-full flex items-center justify-center font-bold">${index + 1}</div>
                        </td>
                        <td class="table-cell">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-gradient-to-r from-blue-400 to-blue-600 rounded-full flex items-center justify-center text-white font-bold text-xs">
                                    ${stock.symbol.substring(0, 3)}
                                </div>
                                <div>
                                    <div class="font-semibold text-gray-900">${stock.symbol}</div>
                                    <div class="text-gray-500">${stock.name || stock.symbol}</div>
                                    ${stock.isPennyStock ? '<div class="text-yellow-600 text-xs">üíé Penny Stock</div>' : ''}
                                </div>
                            </div>
                        </td>
                        <td class="table-cell">
                            <div class="font-mono text-lg font-semibold">$${stock.price.toFixed(2)}</div>
                        </td>
                        <td class="table-cell">
                            <div class="font-semibold ${changeClass}">${stock.change24h >= 0 ? '+' : ''}${stock.change24h.toFixed(2)}%</div>
                            ${stock.change1h ? `<div class="text-gray-500 text-xs">${stock.change1h >= 0 ? '+' : ''}${stock.change1h.toFixed(2)}% (1h)</div>` : ''}
                        </td>
                        <td class="table-cell">
                            <div class="font-semibold">${formatVolume(stock.volume)}</div>
                        </td>
                        <td class="table-cell">
                            <span class="${getRvolBadgeClass(stock.rvol)}">${stock.rvol}x</span>
                        </td>
                        <td class="table-cell">
                            <span class="font-mono">${stock.rsi.toFixed(1)}</span>
                        </td>
                        <td class="table-cell">
                            <div class="text-center">
                                <div class="${aiScoreBadge.class}">${stock.aiScore}</div>
                                <div class="${momentumBadge.class}">${stock.momentum}</div>
                            </div>
                        </td>
                        <td class="table-cell">
                            <button class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-
